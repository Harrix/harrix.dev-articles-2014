---
date: 2014-04-09
categories:
  - it
  - photo
tags:
  - Time-lapse
  - Adobe After Effects
  - VirtualDub
  - Deflicker
related-id: time-lapse
update: 2018
author: Anton Sergienko
author-email: anton.b.sergienko@gmail.com
license: CC BY 4.0
license-url: https://github.com/Harrix/harrix.dev/blob/main/LICENSE.md
permalink-source: https://github.com/Harrix/harrix.dev-articles-2014/blob/main/how-to-make-time-lapse-4/how-to-make-time-lapse-4.md
permalink: https://harrix.dev/ru/articles/2014/how-to-make-time-lapse-4/
lang: ru
---

# Как сделать Time-lapse видео. Часть 4 — Сложная, но качественная сборка видео

![Featured image](featured-image.svg)

Во третей части обсудим как собрать видео из фотографий в Adobe After Effects CS6.

## Содержание

- [Создание проекта](#создание-проекта)
- [Стабилизация видео](#стабилизация-видео)
- [Удаление шумов (птиц и насекомых)](#удаление-шумов-птиц-и-насекомых)
- [Эффект движения камеры и финальное редактирование в After Effects](#эффект-движения-камеры-и-финальное-редактирование-в-after-effects)
- [Убирание мерцания](#убирание-мерцания)
- [Сжатие файла](#сжатие-файла)

Решил написать серию статей о том, как собрать нормальное Time-lapse видео для новичков. В интернете мало материала, которые бы показывали, как собрать видео не с профессиональной техникой, как исправлять проблемные моменты… Я сам непрофессионал в данной области, так что можно считать, что эти статьи написаны для памятки себе.

Вот, что мы получим в итоге:

<https://www.youtube.com/watch?v=9Ta4LNR_6AI>

**Что потребуется**: снимки, After Effects, VirtualDub, Xilisoft Video Converter Ultimate.

## Создание проекта

Откроем наш After Effects. Я показываю на примере After Effects CS6:

![Создание проекта в After Effects](img/after-effects_01.png)

_Рисунок 1 — Создание проекта в After Effects_

Создадим проект в режиме FULL-HD с 24 кадрами в секунду:

![Выбор шаблона видео](img/after-effects_02.png)

_Рисунок 2 — Выбор шаблона видео_

Получим вот такой монтажный стол:

![Основное окно After Effects](img/after-effects_03.png)

_Рисунок 3 — Основное окно After Effects_

Добавим наши изображения к проекту через `File` → `Import` → `Multiple Files…`:

![Вызов команды импорта изображений](img/after-effects_04.png)

_Рисунок 4 — Вызов команды импорта изображений_

При этом выбираем только первую фотографию! Остальные выделять не надо. Программа сама добавит все рисунки из этой папки. Поэтому будьте осторожны и следите, чтобы в папке были только нужные вам файлы:

![Выбор одной фотографии из папки](img/after-effects_05.png)

_Рисунок 5 — Выбор одной фотографии из папки_

После нажатия на `OK` вам предложат добавить еще файлы, но вы откажитесь:

![Отказа от добавления других файлов](img/after-effects_06.png)

_Рисунок 6 — Отказа от добавления других файлов_

И в списке файлов и объектов проекта появится сборник всех фотографий, где фотографии уже расположены в правильном порядке и с правильной длительностью:

![Объект со всеми фотографиями из папки](img/after-effects_07.png)

_Рисунок 7 — Объект со всеми фотографиями из папки_

Теперь смотрите. Основной монтажный стол у нас для видео 1920 × 1080 px. А фотографии у нас куда большего размера. Если мы перетащим фотографии сразу в основное видео и там обработаем, то потом не сможем приближать и удалять кадры и так далее. Поэтому обработаем фотографии на монтажном столе такого же размера, что и размер фотографий. Для этого щелкаем правой кнопкой по объекту фотографий и идем в `New Comp from Selection`:

![Создание новой Sequence](img/after-effects_08.png)

_Рисунок 8 — Создание новой Sequence_

Получили новый Sequence:

![Новая Sequence в списке ресурсов](img/after-effects_09.png)

_Рисунок 9 — Новая Sequence в списке ресурсов_

Двойной щелчок и мы перешли на монтажный стол этого Sequence:

![Второй монтажный стол](img/after-effects_10.png)

_Рисунок 10 — Второй монтажный стол_

Проект мы создали. Теперь займемся стабилизацией видео, так как камера в данном случае сильно дрожала на ветру, и итоговое видео колбасит.

## Стабилизация видео

Откройте вкладку `Window` → `Tracker`:

![Открытие окна Tracker](img/after-effects_11.png)

_Рисунок 11 — Открытие окна Tracker_

И в этой панели вызываем команду `Warp Stabilizer`. Данный метод мне помог, но если вам не помогает, то попробуйте другие из данного набора:

![Выбор Warp Stabilizer](img/after-effects_12.png)

_Рисунок 12 — Выбор Warp Stabilizer_

После нажатия на кнопку начнется долгий процесс:

![Процесс стабилизации](img/after-effects_13.png)

_Рисунок 13 — Процесс стабилизации_

В итоге наше видео стабилизируется.

## Удаление шумов (птиц и насекомых)

В процессе съемок в кадр могут попадать шумы: случайно залетевшие насекомые, птицы, которые попадают на один кадр, а потом улетают. В итоге получается видео с шумами, как в старом кино. Что делать? Предлагается такая идея (не моя): вставить на видео такое же видео над ним, но смещенное на один кадр, и режим смешивания будет поставлено на Lighten. Что это даст? Два соседних кадра не сильно отличаются друг от друга, и при наложении если и создаться небольшое «мыло», то повышением резкости можно убрать это мыло. А вот насекомые и птицы обычно в виде черных пятен выступают. Так как они от кадра к кадру перемещаются, то режимом смешивания они и уберутся. Но есть недостаток в случае, если у нас в кадре есть близко лежащие объекты, которые динамически двигаются. У меня, например, это трава на переднем плане. И при использовании метода получается раздвоение этой травы. Поэтому наложим маску или разукрасим верхнее видео в тех областях, в которых наложение нам не нужно. Надеюсь, понятно объяснил. Эффект раздвоения травы:

![Эффект раздвоения травы](img/after-effects_14.png)

_Рисунок 14 — Эффект раздвоения травы_

Для этого создадим еще один Sequence на основе существующего:

![Создание новой Sequence](img/after-effects_15.png)

_Рисунок 15 — Создание новой Sequence_

И переименуем его в `Without Noise`:

![Переименование Sequence](img/after-effects_16.png)

_Рисунок 16 — Переименование Sequence_

![Новое имя Sequence](img/after-effects_17.png)

_Рисунок 17 — Новое имя Sequence_

Перейдем в `Without Noise`. И перетащим еще один Sequence с фотографиями:

![Добавление объекта с фотографиями](img/after-effects_18.png)

_Рисунок 18 — Добавление объекта с фотографиями_

Верхний слой перетащим на один фрейм вправо:

![Перетаскивание одного слоя на один фрейм](img/after-effects_19.png)

_Рисунок 19 — Перетаскивание одного слоя на один фрейм_

Добавим маску для верхнего слоя:

![Создание новой маски](img/after-effects_20.png)

_Рисунок 20 — Создание новой маски_

Откроем нашу маску у слоя:

![Открытие маски слоя](img/after-effects_21.png)

_Рисунок 21 — Открытие маски слоя_

Щелкнем по маске двойным щелчком. И увидим следующее:

![Открытая маска слоя](img/after-effects_22.png)

_Рисунок 22 — Открытая маска слоя_

Берем кисточку и выбираем черный цвет:

![Выбор инструмента для работы с маской](img/after-effects_23.png)

_Рисунок 23 — Выбор инструмента для работы с маской_

И закрашиваем ту область, которую мы не хотим потом обрабатывать в дальнейшем:

![Закрашивание области с близкими объектами](img/after-effects_24.png)

_Рисунок 24 — Закрашивание области с близкими объектами_

Переходим в обычное окно просмотра видео:

![Переход в стандартный просмотр видео](img/after-effects_25.png)

_Рисунок 25 — Переход в стандартный просмотр видео_

Переходим к выбору типа смешивания слоя:

![Режим смешивания слоя](img/after-effects_26.png)

_Рисунок 26 — Режим смешивания слоя_

У меняем на `Lighten`:

![Изменение режима смешивания на Lighten](img/after-effects_27.png)

_Рисунок 27 — Изменение режима смешивания на Lighten_

Посмотрите на пример. Вот тут видим размытое пятно какого-то насекомого:

![Кадр с пятном от насекомого не в фокусе](img/after-effects_28.png)

_Рисунок 28 — Кадр с пятном от насекомого не в фокусе_

А с нашим способом оно исчезло:

![Пятно от насекомого исчезло](img/after-effects_29.png)

_Рисунок 29 — Пятно от насекомого исчезло_

## Эффект движения камеры и финальное редактирование в After Effects

На данный момент имеем такую картину:

![Текущее состояние редактора видео](img/after-effects_30.png)

_Рисунок 30 — Текущее состояние редактора видео_

Кстати, масштаб просмотра видео можно менять на тот, что вам нужен:

![Изменение масштаба в плеере просмотра видео](img/after-effects_31.png)

_Рисунок 31 — Изменение масштаба в плеере просмотра видео_

На основе предыдущего Sequence создадим еще одну и переименуем в `Finish Source`:

![Создание новой Sequence](img/after-effects_32.png)

_Рисунок 32 — Создание новой Sequence_

![Новая Sequence](img/after-effects_33.png)

_Рисунок 33 — Новая Sequence_

Это мы сделали для удобства, чтобы не таскаться с двумя сдвинутыми слоями и маской. Теперь перейдем в наш самый первоначальный монтажный стол (у меня `Comp 1`) и перетащим туда наш последний Sequence:

![Перетаскивание Sequence в главный монтажный стол](img/after-effects_34.png)

_Рисунок 34 — Перетаскивание Sequence в главный монтажный стол_

Уменьшите размер слоя в окне просмотра видео. Так как я хочу сделать еще эффект движения, то не полностью вписываю слой под размер экрана:

![Размер объекта с фотографиями специально больше кадра](img/after-effects_35.png)

_Рисунок 35 — Размер объекта с фотографиями специально больше кадра_

Теперь перейдем к настройкам нашего слоя на монтажном слое:

![Настройки слоя](img/after-effects_36.png)

_Рисунок 36 — Настройки слоя_

Убедитесь, что каретка помещена в начало ролика. После этого щелкните по изображениям часиков около `Position` и `Scale`. Тем самым мы создадим ключевой кадр, где эти параметры будут фиксированы:

![Создание ключевого кадра](img/after-effects_37.png)

_Рисунок 37 — Создание ключевого кадра_

Переместите каретку на последний кадр:

![Перемещение каретки на последний кадр](img/after-effects_38.png)

_Рисунок 38 — Перемещение каретки на последний кадр_

Сдвиньте и измените масштаб слоя в окне просмотра видео. При этом будет создан второй ключевой кадр:

![Изменение размера фотографий и их положения](img/after-effects_39.png)

_Рисунок 39 — Изменение размера фотографий и их положения_

Всё! Обработку в After Effects мы закончили. Теперь запустим генерацию видео. Перейдем в меню экспорта:

![Выбор пункта экспорта видео](img/after-effects_40.png)

_Рисунок 40 — Выбор пункта экспорта видео_

Устанавливаем настройки по максимуму и запускаем `Render`:

![Настройки экспортируемого видео](img/after-effects_41.png)

_Рисунок 41 — Настройки экспортируемого видео_

И начнется процесс рендеринга:

![Процесс рендеринга](img/after-effects_42.png)

_Рисунок 42 — Процесс рендеринга_

В итоге получим наш видеофайл:

![Сгенерированный файл](img/after-effects_43.png)

_Рисунок 43 — Сгенерированный файл_

## Убирание мерцания

Видео мы получили. Дрожание камеры убрали. Насекомых убрали. Красивое плавное движение камеры добавили. Но осталось мерцание видео, так как снимки снимались в автоматическом режиме. Надо убрать. В After Effects я не нашел штатных средств для решения задачи. Вроде есть плагины, но они платные и так их не нашел по-быстрому. Для решения будем использовать бесплатную программу <http://www.virtualdub.org/download.html>.

В папку плагинов `plugins32` надо закинуть плагин `MSU Deflicker v1.3`.

Этот плагин можно тут взять: [msu_deflick.zip](files/msu_deflick.zip).

А можно всю сборку сразу скачать: [VirtualDub-1.10.4.zip](files/VirtualDub-1.10.4.zip).

Запускаем главный EXE файл:

![Запуск VirtualDub](img/virtualdub_01.png)

_Рисунок 44 — Запуск VirtualDub_

Не открывая видео, заходим в фильтры:

![Переход в окно фильтров](img/virtualdub_02.png)

_Рисунок 45 — Переход в окно фильтров_

Жмем кнопку добавления фильтра:

![Добавление нового фильтра](img/virtualdub_03.png)

_Рисунок 46 — Добавление нового фильтра_

Добавляем наш фильтр `MSU Deflicker v1.3`:

![Добавление фильтра MSU Deflicker](img/virtualdub_04.png)

_Рисунок 47 — Добавление фильтра MSU Deflicker_

Параметры по умолчанию оставляем:

![Выбор параметров фильтра](img/virtualdub_05.png)

_Рисунок 48 — Выбор параметров фильтра_

Жмем `OK`:

![Нажатие на кнопку OK](img/virtualdub_06.png)

_Рисунок 49 — Нажатие на кнопку OK_

Теперь открываем видеофайл:

![Открытие видеофайла](img/virtualdub_07.png)

_Рисунок 50 — Открытие видеофайла_

Открыли:

![Загруженный видеофайл](img/virtualdub_08.png)

_Рисунок 51 — Загруженный видеофайл_

И сразу сохраняем в AVI формате:

![Сохранение файла с примененным фильтром](img/virtualdub_09.png)

_Рисунок 52 — Сохранение файла с примененным фильтром_

В результате начнется преобразование, чтобы убрать мерцание картинки:

![Процесс преобразования](img/virtualdub_10.png)

_Рисунок 53 — Процесс преобразования_

Получим в итоге новый видео файл. Фактически это итоговый конечный файл, который можно уже использовать где надо: загружать на сайты, редактировать и так далее:

![Файл видео без мерцаний](img/virtualdub_11.png)

_Рисунок 54 — Файл видео без мерцаний_

## Сжатие файла

Эта часть не обязательная. И его можно сделать многими способами. У нас есть большой видеофайл в 10 секунд размером больше 1 Гб. Многовато. Надо сжать. Будем сжимать программой Xilisoft Video Converter Ultimate:

![Окно загрузки программы](img/converter_01.png)

_Рисунок 55 — Окно загрузки программы_

Зададим такие настройки:

![Выбор настроек конвертации](img/converter_02.png)

_Рисунок 56 — Выбор настроек конвертации_

И запускаем преобразование:

![Запуск конвертации](img/converter_03.png)

_Рисунок 57 — Запуск конвертации_

![Процесс конвертации](img/converter_04.png)

_Рисунок 58 — Процесс конвертации_

В итоге получили видео, как в начале статьи.

Вроде получилось неплохо. Конечно, можно был поработать над резкостью и так далее, но это вы уже сможете сделать сами.

**Update 2018.** Сейчас я бы вместо Xilisoft Video Converter Ultimate воспользовался Adobe Premiere.

У меня в итоге получилось вот такое видео:

<https://www.youtube.com/watch?v=g0XnvLhvHN4>
