---
date: 2014-05-19
categories:
  - it
  - programming
tags:
  - Qt
  - –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä
  - C++
  - QtScript
latex: true
author: Anton Sergienko
author-email: anton.b.sergienko@gmail.com
license: CC BY 4.0
license-url: https://github.com/Harrix/harrix.dev/blob/main/LICENSE.md
permalink-source: https://github.com/Harrix/harrix.dev-articles-2014/blob/main/qtscript/qtscript.md
permalink: https://harrix.dev/ru/articles/2014/qtscript/
lang: ru
---

# –ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–∏ –≤ Qt ‚Äî QtScript

![Featured image](featured-image.svg)

–í–æ–∑–Ω–∏–∫–ª–∞ –ø–æ—Ç—Ä–µ–±–Ω–æ—Å—Ç—å –≤ –∏–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä–µ –ø—Ä–æ—Å—Ç—ã—Ö —Ñ—É–Ω–∫—Ü–∏–π –≤ —Å—Ä–µ–¥–µ Qt. –ù–∞–ø—Ä–∏–º–µ—Ä, —É –≤–∞—Å –ø—Ä–æ–≥—Ä–∞–º–º–∞, –≥–¥–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–∞–º –≤–≤–µ—Å—Ç–∏ —Å–≤–æ—é —Ñ—É–Ω–∫—Ü–∏—é, –∫–æ—Ç–æ—Ä–∞—è —á—Ç–æ-—Ç–æ —Å—á–∏—Ç–∞–µ—Ç (–Ω–∞–ø—Ä–∏–º–µ—Ä, sin(x)). –ö–∞–∫ –±—ã—Ç—å? –í Qt –µ—Å—Ç—å —Ö–æ—Ä–æ—à–∏–π –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π —è–∑—ã–∫ QtScript –∫–∞–∫ —Ä–∞–∑ –¥–ª—è —ç—Ç–∏—Ö –Ω—É–∂–¥. –ï–¥–∏–Ω—Å—Ç–≤–µ–Ω–Ω–æ, —á—Ç–æ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å —É –Ω–µ–≥–æ –ø–æ–¥ JavaScript, —Ö–æ—Ç—è –º–Ω–µ –±–æ–ª—å—à–µ –ø–æ –¥—É—à–µ –±—ã–ª –±—ã C++, –Ω–æ –ª–∞–¥–Ω–æ.

<details>
<summary>üìñ –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ</summary>

- [–ü—Ä–æ—Ü–µ—Å—Å](#–ø—Ä–æ—Ü–µ—Å—Å)
- [–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è](#–≤—ã—á–∏—Å–ª–µ–Ω–∏–µ-–ø—Ä–æ—Å—Ç–æ–≥–æ-–≤—ã—Ä–∞–∂–µ–Ω–∏—è)

**–í–Ω–∏–º–∞–Ω–∏–µ!** QtScript ‚Äî **—É—Å—Ç–∞—Ä–µ–ª**! –í–º–µ—Å—Ç–æ –Ω–µ–≥–æ –Ω–∞–¥–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å **QJSEngine**. –í —Å—Ç–∞—Ç—å–µ [–ò–Ω—Ç–µ—Ä–ø—Ä–µ—Ç–∞—Ç–æ—Ä —Ñ—É–Ω–∫—Ü–∏–π –≤ Qt ‚Äî QJSEngine](https://github.com/Harrix/harrix.dev-articles-2016/blob/main/qjsengine/qjsengine.md) | [ü°•](https://harrix.dev/ru/articles/2016/qjsengine/) –ø—Ä–æ –Ω–µ–≥–æ —Ä–∞—Å—Å–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –≤–µ—â–∏, –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–µ –≤ –¥–∞–Ω–Ω–æ–π —Å—Ç–∞—Ç—å–µ –¥–ª—è QtScript.

–ü—Ä–∏ –Ω–∞–ø–∏—Å–∞–Ω–∏–∏ —Å—Ç–∞—Ç—å–∏ –∏ –∏–∑—É—á–µ–Ω–∏–∏ –º–∞—Ç–µ—Ä–∏–∞–ª–∞ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–ª–∞—Å—å —Å—Ç–∞—Ç—å—è <https://pro-prof.com/archives/1316>.

–ú—ã –±—É–¥–µ–º —Ä–∞—Å—Å–º–∞—Ç—Ä–∏–≤–∞—Ç—å –ø—Ä–æ—Å—Ç—ã–µ –º–∞—Ç–µ–º–∞—Ç–∏—á–µ—Å–∫–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ —Å –æ–¥–Ω–æ–π –∏ –¥–≤—É–º—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–º–∏. –ü–æ –∞–Ω–∞–ª–æ–≥–∏–∏ —Å –Ω–∏–º–∏ –≤—ã —Å–º–æ–∂–µ—Ç–µ –º–æ–¥–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –∫–æ–¥ –ø–æ–¥ —Å–µ–±—è.

**–ü–æ—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–¥–∞—á–∏:** –£ –Ω–∞—Å –≤ –ø–µ—Ä–µ–º–µ–Ω–Ω–æ–π —Ç–∏–ø–∞ QString –∑–∞–ø–∏—Å–∞–Ω –∫–æ–¥ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–æ–π —Ñ—É–Ω–∫—Ü–∏–∏: $y(x)=sin(x)+1$. –ù–∞–¥–æ –ø–æ—Å—á–∏—Ç–∞—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —ç—Ç–æ–π —Ç–æ—á–∫–µ.

–î–ª—è –æ–±—ä—è—Å–Ω–µ–Ω–∏—è –±—É–¥—É –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –ø—Ä–æ—Å—Ç–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –≤ Qt –Ω–∞ Qt Widgets.

</details>

## –ü—Ä–æ—Ü–µ—Å—Å

–í–Ω–∞—á–∞–ª–µ –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—Å–∞—Ç—å –≤ —Ñ–∞–π–ª–µ –ø—Ä–æ–µ–∫—Ç–∞ `.pro` —Ñ–∞–∫—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è QtScript —á–µ—Ä–µ–∑ –¥–æ–±–∞–≤–ª–µ–Ω–∏—è —Å–ª–æ–≤–∞ `script`. –ë–µ–∑ —ç—Ç–æ–≥–æ –Ω–µ –±—É–¥—É—Ç –ø–æ–¥–∫–ª—é—á–∞—Ç—å—Å—è –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã–µ —Ñ–∞–π–ª—ã:

```cpp
QT       += core gui script
```

![–ú–µ—Å—Ç–æ, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –≤–ø–∏—Å–∞—Ç—å script](img/qtscript_01.png)

_–†–∏—Å—É–Ω–æ–∫ 1 ‚Äî –ú–µ—Å—Ç–æ, –∫—É–¥–∞ –Ω—É–∂–Ω–æ –≤–ø–∏—Å–∞—Ç—å script_

![–ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª](img/qtscript_02.png)

_–†–∏—Å—É–Ω–æ–∫ 2 ‚Äî –ò–∑–º–µ–Ω–µ–Ω–Ω—ã–π —Ñ–∞–π–ª_

–í —Ñ–∞–π–ª–µ `mainwindow.cpp` –∏–ª–∏ –≤ —Ç–æ–º, —á—Ç–æ –≤–∞–º –Ω—É–∂–Ω–æ –ø—Ä–æ–ø–∏—à–∏—Ç–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –±–∏–±–ª–∏–æ—Ç–µ–∫–∏:

```cpp
#include <QtScript/QScriptEngine>
```

![–ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤](img/qtscript_03.png)

_–†–∏—Å—É–Ω–æ–∫ 3 ‚Äî –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∑–∞–≥–æ–ª–æ–≤–æ—á–Ω—ã—Ö —Ñ–∞–π–ª–æ–≤_

–ê –≤ –∫–Ω–æ–ø–∫–µ –ø—Ä–æ–ø–∏—à–∏—Ç–µ —Ç–∞–∫–æ–π –∫–æ–¥:

```cpp
//–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
double x=2;//–≤ –∫–∞–∫–æ–π —Ç–æ—á–∫–∏ –∏—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
QString CodeFunction="RESULT = Math.sin(x);RESULT = RESULT + 1;";

//–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
double Result;
QScriptEngine engine;
QScriptValue scriptFun;

//–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–≤–∏–∂–∫–∞ QtScript
engine.evaluate("function fun(x)\n {\n var RESULT=0;\n"+CodeFunction+"\n return RESULT;\n}\n");
scriptFun = engine.globalObject().property("fun");

//–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ—á–∫–µ
Result = scriptFun.call(QScriptValue(), QScriptValueList() << x).toNumber();

ui->textEdit->insertPlainText(QString::number(Result)+"\n");
```

![–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏](img/qtscript_04.png)

_–†–∏—Å—É–Ω–æ–∫ 4 ‚Äî –ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏_

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è –∏ –Ω–∞–∂–∞—Ç–∏–∏ –Ω–∞ –∫–Ω–æ–ø–∫—É –ø–æ–ª—É—á–∏—Ç–µ –≤–æ—Ç —ç—Ç–æ:

![–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã](img/qtscript_05.png)

_–†–∏—Å—É–Ω–æ–∫ 5 ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã_

–î–ª—è —Ñ—É–Ω–∫—Ü–∏–∏ —Å –¥–≤—É–º—è –∞—Ä–≥—É–º–µ–Ω—Ç–∞–º–∏ (–Ω–∞–ø—Ä–∏–º–µ—Ä, $z(x,y)=x+y$) –∫–æ–¥ –±—É–¥–µ—Ç –Ω–µ–º–Ω–æ–≥–æ –æ—Ç–ª–∏—á–∞—Ç—å—Å—è:

```cpp
//–ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞
double x=2, y=3;//–≤ –∫–∞–∫–æ–π —Ç–æ—á–∫–∏ –∏—â–µ–º –∑–Ω–∞—á–µ–Ω–∏–µ —Ñ—É–Ω–∫—Ü–∏–∏
QString CodeFunction="RESULT = x+y;";

//–ù–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ
double Result;
QScriptEngine engine;
QScriptValue scriptFun;

//–ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –¥–≤–∏–∂–∫–∞ QtScript
engine.evaluate("function fun(x,y)\n {\n var RESULT=0;\n"+CodeFunction+"\n return RESULT;\n}\n");
scriptFun = engine.globalObject().property("fun");

//–í—ã—á–∏—Å–ª–µ–Ω–∏–µ –∑–Ω–∞—á–µ–Ω–∏—è —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Ç–æ—á–∫–µ
Result = scriptFun.call(QScriptValue(), QScriptValueList() << x << y).toNumber();

ui->textEdit->insertPlainText(QString::number(Result)+"\n");
```

![–ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏](img/qtscript_06.png)

_–†–∏—Å—É–Ω–æ–∫ 6 ‚Äî –ö–æ–¥ –æ–±—Ä–∞–±–æ—Ç–∫–∏ –∫–ª–∏–∫–∞ –∫–Ω–æ–ø–∫–∏_

–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø–æ–ª—É—á–∏–º –≤–æ—Ç —ç—Ç–æ:

![–†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã](img/qtscript_07.png)

_–†–∏—Å—É–Ω–æ–∫ 7 ‚Äî –†–µ–∑—É–ª—å—Ç–∞—Ç –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ø—Ä–æ–≥—Ä–∞–º–º—ã_

## –í—ã—á–∏—Å–ª–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è

–ï—Å–ª–∏ –∂–µ –≤–∞–º –Ω—É–∂–Ω–æ –≤—ã—á–∏—Å–ª–∏—Ç—å –∑–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ—Å—Ç–æ–≥–æ –≤—ã—Ä–∞–∂–µ–Ω–∏—è –±–µ–∑ –≤—Å—è–∫–∏—Ö –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö, —Ç–æ –≤—Å—ë –≥–æ—Ä–∞–∑–¥–æ –ø—Ä–æ—â–µ. –ù–∞–ø—Ä–∏–º–µ—Ä, –≤—ã —Ö–æ—Ç–∏—Ç–µ –≤—ã—á–∏—Å–ª–∏—Ç—å –ø—Ä–∏–º–µ—Ä $2+2\cdot2$. –¢–æ–≥–¥–∞ –∫–æ–¥ –±—É–¥–µ—Ç –≤—ã–≥–ª—è–¥–µ—Ç—å —Ç–∞–∫:

```cpp
QString CodeFunction="2+2*2";

QScriptEngine engine;

double Result = engine.evaluate(CodeFunction).toNumber();

ui->textEdit->insertPlainText(QString::number(Result)+"\n");
```

–í—ã –º–æ–∂–µ—Ç–µ —Å–ø–æ–∫–æ–π–Ω–æ –≤–≤–æ–¥–∏—Ç—å —Ç–µ–∫—Å—Ç—ã —Ñ—É–Ω–∫—Ü–∏–π –Ω–∞ —è–∑—ã–∫–µ QtScript (–¥–ª—è –ø—Ä–æ—Å—Ç—ã—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏–π –∫–∞–∫ JavaScript) —á–µ—Ä–µ–∑ —Ñ–∞–π–ª—ã, –ø–æ–ª—è –≤–≤–æ–¥–∞ –∏ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ —Ñ—É–Ω–∫—Ü–∏–∏ –≤ —Å–≤–æ–∏—Ö –≤—ã—á–∏—Å–ª–µ–Ω–∏—è—Ö. –ö–æ–Ω–µ—á–Ω–æ, —Ä–∞–±–æ—Ç–∞ —Ç–∞–∫–∏—Ö —Ñ—É–Ω–∫—Ü–∏–π –±—É–¥–µ—Ç –ø–æ–º–µ–Ω—å—à–µ, —á–µ–º —É –æ–±—ã—á–Ω—ã—Ö, –ø—Ä–æ–ø–∏—Å–∞–Ω–Ω—ã—Ö –Ω–∞ C++ –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–≥—Ä–∞–º–º—ã, –Ω–æ —ç—Ç–æ –∏ –µ—Å—Ç–µ—Å—Ç–≤–µ–Ω–Ω–æ.
